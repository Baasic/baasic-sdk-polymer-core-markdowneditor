<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="baasic-markdownpreview.html" />

<!--
An element providing a solution to no problem in particular.

Example:

    <baasic-markdowneditor></baasic-markdowneditor>

@demo
-->
<dom-module id="baasic-markdowneditor">

    <template>
        <link rel="stylesheet" href="../codemirror/lib/codemirror.css">
        <link rel="stylesheet" type="text/css" href="baasic-markdowneditor.css" />
        <div id="container" layout horizontal>
            <div class="block">
                <h2 class="info">Markdown</h2>
                <div id="editor"></div>
            </div>
            <!-- preview pane is removed; turn on if you need instant markdown preview.
            <div class="block">
                <h2 class="info">Preview</h2>
                <baasic-markdownpreview id="preview" value="{{value}}" />
            </div>  -->
        </div>
    </template>
    <script src="../codemirror/lib/codemirror.js"></script>
    <script src="../codemirror/mode/markdown/markdown.js"></script>

</dom-module>

<script>

  Polymer({

    is: 'baasic-markdowneditor',

    properties: {
        value: {
            type: String,
            notify: true,
            observer: 'valueChanged'
        },
        model: {
            type: Object,
            notify: true
        }

    },
    editor: null,

    // Element Lifecycle
    ready: function() {
        var markdownElement = this.$.editor;
        
        editor = CodeMirror(markdownElement, {
            mode: "markdown",
            lineNumbers: false
        });

        var _this = this;

        editor.on('changes', function () {
            _this.model.setValue(editor.getValue());
            _this.modelValueChanged(editor.getValue());
        });

        // INIT
        this.model = new MarkdownEditorModel(this.value);
    },

    modelValueChanged: function (newValue) {
        if (editor.getValue() != newValue) {
            editor.setValue(newValue);
        }
        this.value = newValue;
    },

    refresh: function () {
        var editor = this.editor;
        setTimeout(function () { editor.refresh(); }, 100);
    },

    valueChanged: function (oldValue, newValue) {
        this.model.setValue(newValue);
    }
  });

  var MarkdownEditorModel = function (value) {
      this.value = value;
  };

  MarkdownEditorModel.prototype.setValue = function (value) {
      if (value != this.value) {
         this.value = value;
      }
  };

</script>
